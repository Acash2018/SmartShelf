# SmartShelf – Backend on AWS (Free Tier)

This guide explains how to deploy and operate the **SmartShelf** backend on a free-tier Ubuntu EC2 instance with a single automation script. It uses:

- Python venv + Gunicorn
- `systemd` service (auto-start on boot)
- Optional Nginx reverse proxy for public HTTP
- SSH tunneling for private/dev access

---

## Repo Layout (relevant)

SmartShelf/
├─ backend/
│ ├─ app.py
│ ├─ requirements.txt
│ ├─ food_items.db # runtime (ignored)
│ ├─ .env # secrets (ignored)
│ └─ .venv/ # virtualenv (ignored)
└─ scripts/
└─ smartshelf_backend_setup.sh

`.gitignore` excludes runtime files:
backend/.env
backend/food_items.db
backend/backups/
backend/.venv/
pycache/
*.pem


---

## Prerequisites

- Ubuntu 24.04 LTS EC2 (t2/t3.micro), 8–16 GiB gp3 root disk
- Security Group: **SSH (22) → My IP**
- (Recommended) **Elastic IP** attached to the instance
- IAM/Key pair for SSH to the instance
- GitHub access (PAT or SSH key) to push/pull the repo

---

## One-Command Install (on the EC2)

> Run as the `ubuntu` user. The script is idempotent; it installs packages, clones/updates the repo, builds a venv, creates a `systemd` service and starts it on **127.0.0.1:8000**.

```bash
# if the repo isn't there yet:
sudo apt update && sudo apt -y install git
git clone https://github.com/Acash2018/SmartShelf /opt/smartshelf/SmartShelf
cd /opt/smartshelf/SmartShelf

# ensure the backend branch is checked out
git checkout Aakash_BackEnd

# copy the automation script here (if not already committed)
# scripts/smartshelf_backend_setup.sh  (executable)
chmod +x scripts/smartshelf_backend_setup.sh

# install / (re)deploy backend
scripts/smartshelf_backend_setup.sh install

What you should see

A systemd service named smartshelf-backend

Gunicorn listening on 127.0.0.1:8000

Local smoke test returns the SmartShelf welcome page

# Update code + deps, restart service
scripts/smartshelf_backend_setup.sh update

# Restart service
scripts/smartshelf_backend_setup.sh restart

# Tail logs
scripts/smartshelf_backend_setup.sh logs

# Manual checks
sudo systemctl status smartshelf-backend --no-pager
sudo journalctl -u smartshelf-backend -n 200 --no-pager
curl -i http://127.0.0.1:8000/

Private (dev)

Keep the API private; access via SSH tunnel.

From your laptop:

ssh -i "$HOME\Downloads\smartshelf-backend.pem" `
    -L 8080:127.0.0.1:8000 ubuntu@<ELASTIC_IP>

Environment & Secrets

The app reads backend/.env via python-dotenv. Create/edit:
FLASK_ENV=production
SMARTSHELF_DB=/opt/smartshelf/SmartShelf/backend/food_items.db
# Optional integrations:
# SENDGRID_API_KEY=...
# OPENAI_API_KEY=...
SECRET_KEY=change-me   # or auto-generated by the script

Reload after changes: sudo systemctl restart smartshelf-backend

Pushing from the EC2 (GitHub Auth)
SSH keys (recommended on servers)
ssh-keygen -t ed25519 -C "you@example.com"   # press Enter for defaults
cat ~/.ssh/id_ed25519.pub


Add the output to GitHub → Settings → SSH and GPG keys → New SSH key.

Switch remote and push:

git remote set-url origin git@github.com:Acash2018/SmartShelf.git
git checkout Aakash_BackEnd
git push -u origin Aakash_BackEnd

Personal Access Token (alternative)

Create a PAT with repo scope, then:

git push -u origin Aakash_BackEnd
# Username: <your GitHub username>
# Password: <paste PAT>

Troubleshooting

SSH times out: update SG “SSH (22) → My IP”; ensure instance is running with 2/2 status checks.

Service not running: sudo journalctl -u smartshelf-backend -n 200; install missing Python packages in the venv.

404/Bad Gateway via Nginx: confirm Gunicorn on 127.0.0.1:8000; sudo nginx -t && sudo systemctl reload nginx.

Disk full: df -h; free space or grow the volume; SQLite requires free disk.

Automation Script

./scripts/smartshelf_backend_setup.sh supports:

install  - full (re)setup: packages, repo, venv, systemd, smoke test
update   - git pull + pip install -r + restart
restart  - restart the systemd service
logs     - tail last 200 lines of service logs


Example:

scripts/smartshelf_backend_setup.sh install
scripts/smartshelf_backend_setup.sh update
scripts/smartshelf_backend_setup.sh logs


That’s it! The backend runs as a service, survives reboots, and can be accessed privately (SSH tunnel) or publicly (Nginx + SG rule).


Want me to commit this file to `Aakash_BackEnd` for you (commands to run), or do you prefer to paste it into GitHub’s UI and open a PR?
::contentReference[oaicite:0]{index=0}
